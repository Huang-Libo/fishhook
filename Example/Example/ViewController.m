//
//  ViewController.m
//  Example
//
//  Created by HuangLibo on 2021/9/12.
//

#import "ViewController.h"
#import <fishhook/fishhook.h>

// ç”¨äºè®°å½•åŸ NSLog çš„å‡½æ•°æŒ‡é’ˆ
static void (*orig_NSLog)(NSString *format, ...);

@interface ViewController ()
@end

@implementation ViewController

// è‡ªå®šä¹‰çš„ NSLog
void my_NSLog(NSString *format, ...) {
    if(!format) {
        return;
    }
    // åœ¨åŸå§‹è¾“å‡ºä¸­æ·»åŠ é¢å¤–çš„ä¿¡æ¯
    NSString *extra = @"ğŸ¤¯";
    format = [extra stringByAppendingString:format];
    va_list args;
    va_start(args, format);
    NSString *message = [[NSString alloc] initWithFormat:format arguments:args];
    // è°ƒç”¨åŸ NSLog
    orig_NSLog(@"%@", message);
    va_end(args);
}

- (void)viewDidLoad {
    [super viewDidLoad];
    
    NSLog(@"Before hook NSLog\n");
    // è°ƒç”¨ fishhook æ¥é‡æ–°ç»‘å®š NSLog å¯¹åº”çš„ç¬¦å·
    struct rebinding rebindings[1] = {
        {"NSLog", my_NSLog, (void *)&orig_NSLog}
    };
    rebind_symbols(rebindings, 1);
    NSLog(@"After hook NSLog\n");
}

@end
